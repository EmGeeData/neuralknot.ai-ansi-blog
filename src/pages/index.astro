---
import BaseHead from '../components/BaseHead.astro';
import { SITE_TITLE, SITE_DESCRIPTION, FOOTER_CONFIG, RECENT_UPDATES, TERMINAL_STATUS, KNOWLEDGE_BASE } from '../consts';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<script src="/terminal.js" is:inline></script>
		<script src="/theme-switcher.js" is:inline></script>
		<script is:inline>
			document.addEventListener('DOMContentLoaded', function() {
				// Initialize theme selector
				const placeholder = document.getElementById('theme-selector-placeholder');
				if (placeholder && window.ThemeSwitcher) {
					const selector = window.ThemeSwitcher.createThemeSelector();
					placeholder.appendChild(selector);
				}
			});
		</script>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<div class="logo">NEURALKNOT.AI</div>
				<div class="tagline">── TECH TERMINAL ──</div>
				<div class="tagline">Node 1 of 3 • Connected at 56k</div>
				<div class="theme-selector-container">
					<span class="theme-selector-label">THEME:</span>
					<div id="theme-selector-placeholder"></div>
				</div>
			</div>

			<div class="ascii-art" id="ascii-art">
			</div>

			<div class="menu">
				<div class="menu-title">═══ MAIN MENU ═══</div>
				<a href="/" class="menu-item">[H] Home Terminal</a>
				<a href="/blog" class="menu-item">[B] Blog Archives</a>
				<a href="/about" class="menu-item">[A] About System</a>
			</div>

			<div class="articles">
				<div class="articles-title">═══ LATEST ARTICLES ═══</div>
				{posts.slice(0, 3).map((post) => (
					<div class="article-item">
						<div class="article-title">
							<a href={`/blog/${post.id}/`}>{post.data.title}</a>
						</div>
						<div class="article-meta">
							Posted: {post.data.pubDate.toLocaleDateString()} | Category: Tech | Author: NeuralHacker
						</div>
						<div class="article-desc">{post.data.description}</div>
					</div>
				))}
			</div>

			<div class="stats">
				<div class="stat-box">
					<div class="stat-title">{TERMINAL_STATUS.title}</div>
					{TERMINAL_STATUS.stats.map((stat) => (
						<div class="stat-value">{stat}</div>
					))}
				</div>
				<div class="stat-box">
					<div class="stat-title">{KNOWLEDGE_BASE.title}</div>
					{KNOWLEDGE_BASE.stats.map((stat) => (
						<div class="stat-value">{stat}</div>
					))}
				</div>
			</div>

			<div class="news">
				<div class="news-title">═══ RECENT UPDATES ═══</div>
				{RECENT_UPDATES.map((update) => (
					<div class="news-item">{update}</div>
				))}
			</div>

			<div class="footer">
				<div>{FOOTER_CONFIG.home.statusLine}</div>
				<div class="blink">{FOOTER_CONFIG.home.promptText}<span class="cursor"></span></div>
				<div style="margin-top: 1em; font-size: 0.8em;">
					{FOOTER_CONFIG.common.copyright} • SysOp: {FOOTER_CONFIG.common.sysop} • Co-SysOp: {FOOTER_CONFIG.common.cosysop}<br>
					Powered by {FOOTER_CONFIG.common.systemName} • {FOOTER_CONFIG.common.fidonet}
				</div>
			</div>
		</div>
	</body>
</html>