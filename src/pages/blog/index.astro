---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import { SITE_DESCRIPTION, SITE_TITLE, FOOTER_CONFIG } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Blog Archives - ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
		<script src="/terminal.js" is:inline></script>
		<script src="/theme-switcher.js" is:inline></script>
		<script is:inline>
			document.addEventListener('DOMContentLoaded', function() {
				const placeholder = document.getElementById('theme-selector-placeholder');
				if (placeholder && window.ThemeSwitcher) {
					const selector = window.ThemeSwitcher.createThemeSelector();
					placeholder.appendChild(selector);
				}
			});
		</script>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<div class="logo">NEURALKNOT.AI</div>
				<div class="tagline">── BLOG ARCHIVES ──</div>
				<div class="tagline">Archive Node • {posts.length} Tech Articles Available</div>
				<div class="theme-selector-container">
					<span class="theme-selector-label">THEME:</span>
					<div id="theme-selector-placeholder"></div>
				</div>
			</div>

			<div class="menu">
				<div class="menu-title">═══ NAVIGATION ═══</div>
				<a href="/" class="menu-item">[H] Home Terminal</a>
				<a href="/blog" class="menu-item">[B] Blog Archives</a>
				<a href="/about" class="menu-item">[A] About System</a>
			</div>

			<div class="articles">
				<div class="articles-title">═══ TECH ARTICLES ═══</div>
				{posts.map((post) => (
					<div class="article-item">
						<div class="article-title">
							<a href={`/blog/${post.id}/`}>{post.data.title}</a>
						</div>
						<div class="article-meta">
							Posted: {post.data.pubDate.toLocaleDateString()} | Category: Tech | 
							{post.data.updatedDate && `Updated: ${post.data.updatedDate.toLocaleDateString()}`}
						</div>
						<div class="article-desc">{post.data.description}</div>
					</div>
				))}
			</div>

			<div class="stats">
				<div class="stat-box">
					<div class="stat-title">ARCHIVE STATUS</div>
					<div class="stat-value">{posts.length} Articles</div>
					<div class="stat-value">Online Archive</div>
					<div class="stat-value">Last Updated</div>
				</div>
				<div class="stat-box">
					<div class="stat-title">LATEST ENTRY</div>
					{posts.length > 0 && (
						<>
							<div class="stat-value" style="font-size: 1em;">{posts[0].data.title.slice(0, 20)}...</div>
							<div class="stat-value">{posts[0].data.pubDate.toLocaleDateString()}</div>
						</>
					)}
				</div>
			</div>

			<div class="footer">
				<div>{FOOTER_CONFIG.blog.statusLine}</div>
				<div class="blink">{FOOTER_CONFIG.blog.promptText}<span class="cursor"></span></div>
				<div style="margin-top: 1em; font-size: 0.8em;">
					{FOOTER_CONFIG.common.copyright} • Archive System v2.0<br>
					Total Tech Articles: {posts.length} • {FOOTER_CONFIG.common.fidonet}
				</div>
			</div>
		</div>
	</body>
</html>